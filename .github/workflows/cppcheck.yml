name: cppcheck-action
on:
  pull_request:
    branches: [main, develop, develop/* ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: get premake5
      run: |
       wget -qO- https://github.com/premake/premake-core/releases/download/v5.0.0-alpha15/premake-5.0.0-alpha15-linux.tar.gz | \
       tar xvz premake5 | \
       xargs -I"{}" sudo mv {} /usr/bin
       
    - name: get cppcheck
      run: sudo apt-get update -yqq && sudo apt-get install -yqq cppcheck
      
    - name: get intercept-build
      run: pip install scan-build

    - name: generate Makefiles
      run: premake5 --file=args/premake5.lua gmake

    - name: make
      run: cd args && /home/runner/.local/bin/intercept-build make CXX=clang++-9 config=debug64 all 
    
    - name: cppcheck
      run: cppcheck --project=args/compile_commands.json --error-exitcode=1 
